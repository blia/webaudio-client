{"version":3,"sources":["index.js"],"names":["context","window","AudioContext","webkitAudioContext","createGain","createGainNode","createDelay","createDelayNode","createScriptProcessor","createJavaScriptNode","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","playSound","buffer","time","source","createBufferSource","connect","destination","start","loadSounds","obj","soundMap","names","paths","name","path","push","bufferLoader","BufferLoader","bufferList","i","length","load","urlList","onload","Array","loadCount","prototype","loadBuffer","url","index","request","XMLHttpRequest","open","responseType","loader","decodeAudioData","response","alert","error","console","onerror","send","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","MicrophoneSample","socket","WebSocket","WIDTH","HEIGHT","getMicrophoneInput","canvas","document","querySelector","isLocalhost","location","hostname","protocol","audio","onStream","bind","onStreamError","stream","input","createMediaStreamSource","filter","createBiquadFilter","frequency","value","type","NOTCH","Q","analyser","createAnalyser","visualize","e","width","height","drawContext","getContext","times","Uint8Array","frequencyBinCount","getByteTimeDomainData","reduce","acc","v","percent","offset","barWidth","fillStyle","fillRect","sample"],"mappings":"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","file":"webaudio.e31bb0bc.map","sourceRoot":"..","sourcesContent":["/*\n * Copyright 2013 Boris Smus. All Rights Reserved.\n\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n // Start off by initializing a new context.\ncontext = new (window.AudioContext || window.webkitAudioContext)();\n\nif (!context.createGain)\n  context.createGain = context.createGainNode;\nif (!context.createDelay)\n  context.createDelay = context.createDelayNode;\nif (!context.createScriptProcessor)\n  context.createScriptProcessor = context.createJavaScriptNode;\n\n// shim layer with setTimeout fallback\nwindow.requestAnimFrame = (function(){\nreturn  window.requestAnimationFrame       ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame    ||\n  window.oRequestAnimationFrame      ||\n  window.msRequestAnimationFrame     ||\n  function( callback ){\n  window.setTimeout(callback, 1000 / 60);\n};\n})();\n\n\nfunction playSound(buffer, time) {\n  var source = context.createBufferSource();\n  source.buffer = buffer;\n  source.connect(context.destination);\n  source[source.start ? 'start' : 'noteOn'](time);\n}\n\nfunction loadSounds(obj, soundMap, callback) {\n  // Array-ify\n  var names = [];\n  var paths = [];\n  for (var name in soundMap) {\n    var path = soundMap[name];\n    names.push(name);\n    paths.push(path);\n  }\n  bufferLoader = new BufferLoader(context, paths, function(bufferList) {\n    for (var i = 0; i < bufferList.length; i++) {\n      var buffer = bufferList[i];\n      var name = names[i];\n      obj[name] = buffer;\n    }\n    if (callback) {\n      callback();\n    }\n  });\n  bufferLoader.load();\n}\n\n\n\n\nfunction BufferLoader(context, urlList, callback) {\n  this.context = context;\n  this.urlList = urlList;\n  this.onload = callback;\n  this.bufferList = new Array();\n  this.loadCount = 0;\n}\n\nBufferLoader.prototype.loadBuffer = function(url, index) {\n  // Load buffer asynchronously\n  var request = new XMLHttpRequest();\n  request.open(\"GET\", url, true);\n  request.responseType = \"arraybuffer\";\n\n  var loader = this;\n\n  request.onload = function() {\n    // Asynchronously decode the audio file data in request.response\n    loader.context.decodeAudioData(\n      request.response,\n      function(buffer) {\n        if (!buffer) {\n          alert('error decoding file data: ' + url);\n          return;\n        }\n        loader.bufferList[index] = buffer;\n        if (++loader.loadCount == loader.urlList.length)\n          loader.onload(loader.bufferList);\n      },\n      function(error) {\n        console.error('decodeAudioData error', error);\n      }\n    );\n  }\n\n  request.onerror = function() {\n    alert('BufferLoader: XHR error');\n  }\n\n  request.send();\n};\n\nBufferLoader.prototype.load = function() {\n  for (var i = 0; i < this.urlList.length; ++i)\n  this.loadBuffer(this.urlList[i], i);\n};\n\n\n\nnavigator.getUserMedia = (navigator.getUserMedia ||\n                          navigator.webkitGetUserMedia ||\n                          navigator.mozGetUserMedia ||\n                          navigator.msGetUserMedia);\nfunction MicrophoneSample() {\n  this.socket = new WebSocket('ws://localhost:1488');\n  this.WIDTH = 640;\n  this.HEIGHT = 480;\n  this.getMicrophoneInput();\n  this.canvas = document.querySelector('canvas');\n}\n\nMicrophoneSample.prototype.getMicrophoneInput = function() {\n  // TODO(smus): Remove this ugliness.\n  var isLocalhost = window.location.hostname == 'localhost' ||\n      window.location.hostname == '127.0.0.1';\n  if (window.location.protocol != 'https:' && !isLocalhost) {\n    alert('HTTPS is required for microphone access, and this site has no SSL cert yet. Sorry!');\n  }\n  navigator.getUserMedia({audio: true},\n                          this.onStream.bind(this),\n                          this.onStreamError.bind(this));\n};\n\nMicrophoneSample.prototype.onStream = function(stream) {\n  var input = context.createMediaStreamSource(stream);\n  var filter = context.createBiquadFilter();\n  filter.frequency.value = 60.0;\n  filter.type = filter.NOTCH;\n  filter.Q = 10.0;\n\n  var analyser = context.createAnalyser();\n\n  // Connect graph.\n  input.connect(filter);\n  filter.connect(analyser);\n\n  this.analyser = analyser;\n  // Setup a timer to visualize some stuff.\n  requestAnimFrame(this.visualize.bind(this));\n};\n\nMicrophoneSample.prototype.onStreamError = function(e) {\n  console.error('Error getting microphone', e);\n};\n\nMicrophoneSample.prototype.visualize = function() {\n  this.canvas.width = this.WIDTH;\n  this.canvas.height = this.HEIGHT;\n  var drawContext = this.canvas.getContext('2d');\n\n  var times = new Uint8Array(this.analyser.frequencyBinCount);\n  this.analyser.getByteTimeDomainData(times);\n  this.socket.send(128 - times.reduce((acc, v) => acc > v ? v : acc, 255));\n  // console.log(times);\n  for (var i = 0; i < times.length; i++) {\n    var value = times[i];\n    var percent = value / 256;\n    var height = this.HEIGHT * percent;\n    var offset = this.HEIGHT - height - 1;\n    var barWidth = this.WIDTH/times.length;\n    drawContext.fillStyle = 'black';\n    drawContext.fillRect(i * barWidth, offset, 1, 1);\n  }\n  requestAnimFrame(this.visualize.bind(this));\n};\n\n\n\nvar sample = new MicrophoneSample();\n"]}