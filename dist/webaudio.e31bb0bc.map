{"version":3,"sources":["index.js"],"names":["context","window","AudioContext","webkitAudioContext","MicrophoneSample","socket","ws","WIDTH","HEIGHT","canvas","document","querySelector","getMicrophoneInput","then","_","console","log","prototype","isLocalhost","location","hostname","protocol","alert","navigator","mediaDevices","getUserMedia","audio","onStream","bind","onStreamError","stream","input","createMediaStreamSource","filter","createBiquadFilter","frequency","value","type","Q","analyser","createAnalyser","connect","requestAnimationFrame","visualize","e","error","width","height","drawContext","getContext","times","Uint8Array","frequencyBinCount","getByteTimeDomainData","send","reduce","acc","v","i","length","percent","offset","barWidth","fillStyle","fillRect","wsButton","micButton","onclick","onerror","onopen","onclose","close","WebSocket","host","sample"],"mappings":"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","file":"webaudio.e31bb0bc.map","sourceRoot":"..","sourcesContent":["/*\n * Copyright 2013 Boris Smus. All Rights Reserved.\n\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n // Start off by initializing a new context.\ncontext = new (window.AudioContext || window.webkitAudioContext)();\n\n\n\nfunction MicrophoneSample() {\n  this.socket = ws;\n  this.WIDTH = 640;\n  this.HEIGHT = 480;\n  this.canvas = document.querySelector('canvas');\n  this.getMicrophoneInput().then(_ => {\n    console.log('mic connected');\n  })\n\n}\n\nMicrophoneSample.prototype.getMicrophoneInput = function() {\n  // TODO(smus): Remove this ugliness.\n  var isLocalhost = window.location.hostname == 'localhost' ||\n      window.location.hostname == '127.0.0.1';\n  if (window.location.protocol != 'https:' && !isLocalhost) {\n    alert('HTTPS is required for microphone access, and this site has no SSL cert yet. Sorry!');\n  }\n  return navigator.mediaDevices.getUserMedia({audio: true}).then(\n                          this.onStream.bind(this),\n                          this.onStreamError.bind(this));\n};\n\nMicrophoneSample.prototype.onStream = function(stream) {\n  var input = context.createMediaStreamSource(stream);\n  var filter = context.createBiquadFilter();\n  filter.frequency.value = 60.0;\n  filter.type = 'notch';\n  filter.Q = 10.0;\n\n  var analyser = context.createAnalyser();\n\n  // Connect graph.\n  input.connect(filter);\n  filter.connect(analyser);\n\n  this.analyser = analyser;\n  // Setup a timer to visualize some stuff.\n  window.requestAnimationFrame(this.visualize.bind(this));\n};\n\nMicrophoneSample.prototype.onStreamError = function(e) {\n  console.error('Error getting microphone', e);\n};\n\nMicrophoneSample.prototype.visualize = function() {\n  this.canvas.width = this.WIDTH;\n  this.canvas.height = this.HEIGHT;\n  var drawContext = this.canvas.getContext('2d');\n\n  var times = new Uint8Array(this.analyser.frequencyBinCount);\n  this.analyser.getByteTimeDomainData(times);\n  this.socket.send(128 - times.reduce((acc, v) => acc > v ? v : acc, 255));\n  console.log(128 - times.reduce((acc, v) => acc > v ? v : acc, 255));\n  // console.log(times);\n  for (var i = 0; i < times.length; i++) {\n    var value = times[i];\n    var percent = value / 256;\n    var height = this.HEIGHT * percent;\n    var offset = this.HEIGHT - height - 1;\n    var barWidth = this.WIDTH/times.length;\n    drawContext.fillStyle = 'black';\n    drawContext.fillRect(i * barWidth, offset, 1, 1);\n  }\n  window.requestAnimationFrame(this.visualize.bind(this));\n};\n\nconst wsButton = document.querySelector('#wsButton');\nconst micButton = document.querySelector('#micButton');\n\nlet ws;\n\nwsButton.onclick = () => {\n  if (ws) {\n    ws.onerror = ws.onopen = ws.onclose = null;\n    ws.close();\n  }\n  ws = new WebSocket(`ws://${location.host}`);\n}\n\nmicButton.onclick = () => {\n  var sample = new MicrophoneSample();\n}\n"]}